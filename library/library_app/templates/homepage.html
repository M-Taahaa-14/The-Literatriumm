{% extends 'base.html' %}
{% block content %}

<style>
  .book-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .book-card:hover {
    transform: scale(1.03);
    box-shadow: 0 0.8rem 1.5rem rgba(0, 0, 0, 0.2);
    z-index: 2;
  }

  #book-slider, #category-slider {
    transition: transform 0.06s ease-in-out;
  }

  .carousel-container {
    position: relative;
    overflow: hidden;
  }
</style>

<div class="container py-5">

  <!-- Header -->
  <div class="text-center mb-5">
    <h1 class="display-4 fw-bold">The Literarium</h1>
    <p class="lead">Where Every Book Begins a New Story</p>
  </div>

  <!-- Search Bar -->
  <form method="get" action="{% url 'search_books' %}" class="row g-3 justify-content-center mb-5">
    <div class="col-md-6">
      <input type="text" name="query" class="form-control" placeholder="Search by Title or Author">
    </div>
    <div class="col-md-2">
      <button class="btn btn-dark w-100" type="submit">Search</button>
    </div>
  </form>

  <!-- Featured Books Carousel -->
  <h2 class="mb-4">Featured Books</h2>
  <div class="position-relative">
    <button id="prevBtn" class="btn btn-dark position-absolute top-50 start-0 translate-middle-y z-2" style="opacity: 0.9; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.2)'" onmouseout="this.style.transform='scale(1)'">&lt;</button>
    <div class="overflow-hidden">
      <div id="book-slider" class="d-flex transition">
        {% for book in featured_books %}
        <a href="{% url 'book_details' book.id %}" class="text-decoration-none text-dark">
          <div class="card me-3 book-card" style="min-width: 18rem; max-width: 18rem;">
            {% if book.cover_image %}
              <img src="{{ book.cover_image.url }}" class="card-img-top" style="height: 350px; object-fit: fill;" alt="{{ book.title }}">
            {% else %}
              <img src="https://via.placeholder.com/300x400?text=No+Cover" class="card-img-top" style="height: 300px; object-fit: cover;" alt="No Image">
            {% endif %}
            <div class="card-body">
              <h5 class="card-title">{{ book.title }}</h5>
              <p class="card-text">by {{ book.author }}</p>
              <p class="card-text"><strong>Available:</strong> {{ book.available_copies }}/{{ book.total_copies }}</p>
              {% if book.available_copies > 0 %}
                <a href="{% url 'borrow_book' book.id %}" class="btn btn-sm btn-dark w-100">Borrow</a>
              {% else %}
                <button class="btn btn-sm btn-secondary w-100" disabled>Not Available</button>
              {% endif %}
            </div>
          </div>
        </a>
        {% endfor %}
      </div>
    </div>
    <button id="nextBtn" class="btn btn-dark position-absolute top-50 end-0 translate-middle-y z-2" style="opacity: 0.9; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.2)'" onmouseout="this.style.transform='scale(1)'">&gt;</button>
  </div>

  <!-- Explore More Books Button -->
  <div class="text-center mt-4 mb-5">
    <a href="{% url 'list_books' %}" class="btn btn-outline-dark px-4">Explore More Books</a>
  </div>

  <!-- Book Categories Carousel -->
  <h2 class="mt-5 mb-4">Browse by Category</h2>
  <div class="position-relative">
    <button id="catPrev" class="btn btn-dark position-absolute top-50 start-0 translate-middle-y z-2" style="opacity: 0.9;">&lt;</button>
    <div class="overflow-hidden">
      <div id="category-slider" class="d-flex transition">
        {% for category in categories %}
        <div class="me-3" style="min-width: 12rem; max-width: 12rem;">
          <a href="{% url 'books_by_category' category.id %}" class="btn btn-outline-dark w-100">{{ category.name }}</a>
        </div>
        {% endfor %}
      </div>
    </div>
    <button id="catNext" class="btn btn-dark position-absolute top-50 end-0 translate-middle-y z-2" style="opacity: 0.9;">&gt;</button>
  </div>
</div>

<!-- JS for both carousels -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Books
    let currentIndex = 0;
    const visibleCards = 3;
    const bookCard = document.querySelector("#book-slider .card");
    const cardWidth = bookCard ? bookCard.offsetWidth + 16 : 300;
    const bookSlider = document.getElementById("book-slider");
    const totalBooks = document.querySelectorAll("#book-slider .card").length;

    document.getElementById("nextBtn").onclick = function () {
      if (currentIndex < totalBooks - visibleCards) {
        currentIndex++;
        bookSlider.style.transform = `translateX(-${cardWidth * currentIndex}px)`;
      }
    };

    document.getElementById("prevBtn").onclick = function () {
      if (currentIndex > 0) {
        currentIndex--;
        bookSlider.style.transform = `translateX(-${cardWidth * currentIndex}px)`;
      }
    };

    // Categories
    let catIndex = 0;
    const visibleCats = 4;
    const catBtn = document.querySelector("#category-slider .me-3");
    const catWidth = catBtn ? catBtn.offsetWidth + 16 : 200;
    const catSlider = document.getElementById("category-slider");
    const totalCats = document.querySelectorAll("#category-slider .me-3").length;

    document.getElementById("catNext").onclick = function () {
      if (catIndex < totalCats - visibleCats) {
        catIndex++;
        catSlider.style.transform = `translateX(-${catWidth * catIndex}px)`;
      }
    };

    document.getElementById("catPrev").onclick = function () {
      if (catIndex > 0) {
        catIndex--;
        catSlider.style.transform = `translateX(-${catWidth * catIndex}px)`;
      }
    };
  });
</script>
{% endblock %}
