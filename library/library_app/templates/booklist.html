{% extends 'base.html' %}
{% block content %}
<h2 class="mb-3"></h2>
<h2 class="mb-2">All Books</h2>

<div class="row row-cols-1 row-cols-md-3 g-4">
  {% for book in books %}
  <div class="col">
    <a href="{% url 'book_details' book.id %}" class="text-decoration-none text-dark">
      <div class="card h-100 shadow-sm">
        {% if book.cover_image %}
          <img src="{{ book.cover_image.url }}" class="card-img-top" style="height: 350px; object-fit: fill;" alt="{{ book.title }}">
        {% else %}
          <img src="https://via.placeholder.com/300x400?text=No+Cover" class="card-img-top" style="height: 300px; object-fit: cover;" alt="No Image">
        {% endif %}
        <div class="card-body">
          <h5 class="card-title">{{ book.title }}</h5>

          <!-- ⭐ Star Rating Display -->
          <div class="mb-2">
            {% with avg=book.average_rating %}
              {% if avg %}
                {% for i in "12345" %}
                  {% if avg|floatformat:0 >= i %}
                    <span class="text-warning">&#9733;</span>
                  {% elif avg|floatformat:0 >= i|add:"-0.5" %}
                    <span class="text-warning">&#9733;</span>
                  {% else %}
                    <span class="text-muted">&#9733;</span>
                  {% endif %}
                {% endfor %}
                <small class="text-muted">({{ avg }}/5.0)</small>
              {% else %}
                <small class="text-muted">No ratings yet</small>
              {% endif %}
            {% endwith %}
          </div>

          <p class="card-text">Author: {{ book.author }}</p>
          <p class="card-text">Available: {{ book.available_copies }}</p>

          {% if book.available_copies > 0 %}
            <a href="/borrow/{{ book.id }}/" class="btn btn-dark w-100">Borrow</a>
          {% else %}
            <button class="btn btn-secondary w-100" disabled>Not Available</button>
          {% endif %}
        </div>
      </div>
    </a>
  </div>
  {% endfor %}
</div>

{% endblock %}
